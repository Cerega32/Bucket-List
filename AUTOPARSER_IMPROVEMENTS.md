# Улучшения автопарсера - Загрузка детальной информации

## Проблема

Ранее автопарсер использовал только базовые данные из поиска внешних API. Когда пользователь создавал цели из списка через автопарсер, они получали только краткую информацию без детальных данных, которые доступны через дополнительные API.

## Решение

Добавлена загрузка детальной информации для целей из внешних API, аналогично тому, как это работает в ExternalGoalSearch при ручном выборе целей.

## Улучшения для книг (FantLab API)

### Что добавлено:

-   Загрузка детальной информации через `get_fantlab_work_details` API
-   Полные описания книг вместо коротких из поиска
-   Изображения обложек книг
-   Расширенные метаданные: авторы, рейтинги, даты публикации, типы произведений

### Пример улучшения:

**До:**

```
Название: Война и мир
Описание: Произведение роман-эпопея Лев Толстой
Изображение: Нет
```

**После:**

```
Название: Война и мир
Описание: Хорошо известный классический роман-эпопея Льва Толстого рассказывает о сложном, бурном периоде в истории...
Изображение: Да
Дополнительные поля:
  - Автор: Лев Толстой
  - Рейтинг: 8.25
  - Тип произведения: Роман-эпопея
  - Количество оценок: 1474
  - Ссылка на FantLab: https://fantlab.ru/work67754
```

## Улучшения для игр (IGDB API)

### Что добавлено:

-   Загрузка времени прохождения через `get_game_time_to_beat_internal` API
-   Информация о времени прохождения (быстрое/обычное/полное)
-   Дополнительные метаданные уже были в базовом поиске

### Пример улучшения:

**До:**

```
Название: God of War
Описание: Action-adventure game...
Время прохождения: Не указано
```

**После:**

```
Название: God of War
Описание: Action-adventure game...
Время прохождения: 35.0 часов
Дополнительные поля:
  - Быстрое прохождение: 26.2 часа
  - Обычное прохождение: 35.0 часов
  - Полное прохождение: 54.3 часа
  - Количество отзывов: 18
```

## Технические изменения

### backend/goal_lists/views/auto_creation_views.py

-   Модифицирована функция `search_external_apis()` для категорий "books" и "gaming"
-   Добавлена загрузка детальной информации для лучшего результата поиска
-   Улучшена обработка ошибок при загрузке дополнительных данных

### backend/goals/views/external_api_views.py

-   Добавлена функция `get_game_time_to_beat_internal()` для внутреннего использования
-   Функция работает без аутентификации для использования в автопарсере

## Результаты тестирования

### Книги (5 тестов):

-   ✅ Все книги найдены через FantLab API
-   ✅ Загружены полные описания
-   ✅ 4 из 5 книг получили изображения
-   ✅ Все получили расширенные метаданные

### Игры (5 тестов):

-   ✅ 4 игры найдены в базе данных
-   ✅ 1 игра загружена через IGDB API
-   ✅ Время прохождения загружено для новой игры
-   ✅ Высокая точность распознавания (0.794-1.000)

## Влияние на производительность

-   Добавлена небольшая задержка для каждой цели (1-2 дополнительных API запроса)
-   Загрузка происходит только для лучшего результата поиска
-   Ошибки загрузки деталей не прерывают создание целей

## Совместимость

-   Все изменения обратно совместимы
-   Старые цели продолжают работать без изменений
-   Новые цели получают расширенную информацию автоматически
